{{- if .Values.testsEnabled -}}
apiVersion: v1
kind: Pod
metadata:
  name: {{ include "common.fullname" . }}-test-cassandra-insertion
  namespace: {{ include "common.namespace" . }}
  annotations:
    "helm.sh/hook": test-success
spec:
  containers:
  - name: {{ include "common.name" . }}-test-cassandra-basic
    image: {{ .Values.image.repo }}:{{ .Values.image.tag }}
    command:
    - sh
    - -c
    - |
      cqlsh opensync-wifi-controller-cassandra.connectus.svc.cluster.local
      CREATE KEYSPACE mydb WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 1 };
      use mydb;
      CREATE TABLE books (id int PRIMARY KEY, title text, year text);
      INSERT INTO books (id, title, year) VALUES (1, 'Power Of Now', '1994');
      SELECT * FROM books;
      DELETE FROM books WHERE id=1;
      DROP TABLE books;
      DROP KEYSPACE mydb;
      exit
      exit      
  restartPolicy: Never
{{- end }}